{% if tweets %}
<div class="overflow-x-auto">
  <table class="table table-zebra w-full">
    <thead>
      <tr class="bg-base-200">
        <th class="text-left">
          <button 
            class="btn btn-ghost btn-sm normal-case font-medium hover:bg-base-300"
            hx-get="/dashboard/api/engagements?sort_by=score&order={% if sort_by == 'score' and order == 'desc' %}asc{% else %}desc{% endif %}"
            hx-target="#engagements-table"
            hx-include="[name='min_score'],[name='max_score'],[name='limit']"
          >
            <span>Score</span>
            {% if sort_by == 'score' %}
              {% if order == 'desc' %}
                <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
                </svg>
              {% else %}
                <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              {% endif %}
            {% endif %}
          </button>
        </th>
        <th class="text-left">
          <button 
            class="btn btn-ghost btn-sm normal-case font-medium hover:bg-base-300"
            hx-get="/dashboard/api/engagements?sort_by=date&order={% if sort_by == 'date' and order == 'desc' %}asc{% else %}desc{% endif %}"
            hx-target="#engagements-table"
            hx-include="[name='min_score'],[name='max_score'],[name='limit']"
          >
            <span>Date</span>
            {% if sort_by == 'date' %}
              {% if order == 'desc' %}
                <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
                </svg>
              {% else %}
                <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              {% endif %}
            {% endif %}
          </button>
        </th>
        <th class="text-left font-medium">Tweet ID</th>
        <th class="text-left font-medium">Text</th>
        <th class="text-left">
          <button 
            class="btn btn-ghost btn-sm normal-case font-medium hover:bg-base-300"
            hx-get="/dashboard/api/engagements?sort_by=likes&order={% if sort_by == 'likes' and order == 'desc' %}asc{% else %}desc{% endif %}"
            hx-target="#engagements-table"
            hx-include="[name='min_score'],[name='max_score'],[name='limit']"
          >
            <span>‚ù§Ô∏è Likes</span>
            {% if sort_by == 'likes' %}
              {% if order == 'desc' %}
                <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
                </svg>
              {% else %}
                <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              {% endif %}
            {% endif %}
          </button>
        </th>
        <th class="text-left">
          <button 
            class="btn btn-ghost btn-sm normal-case font-medium hover:bg-base-300"
            hx-get="/dashboard/api/engagements?sort_by=retweets&order={% if sort_by == 'retweets' and order == 'desc' %}asc{% else %}desc{% endif %}"
            hx-target="#engagements-table"
            hx-include="[name='min_score'],[name='max_score'],[name='limit']"
          >
            <span>üîÑ RTs</span>
            {% if sort_by == 'retweets' %}
              {% if order == 'desc' %}
                <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
                </svg>
              {% else %}
                <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              {% endif %}
            {% endif %}
          </button>
        </th>
        <th class="text-left">
          <button 
            class="btn btn-ghost btn-sm normal-case font-medium hover:bg-base-300"
            hx-get="/dashboard/api/engagements?sort_by=replies&order={% if sort_by == 'replies' and order == 'desc' %}asc{% else %}desc{% endif %}"
            hx-target="#engagements-table"
            hx-include="[name='min_score'],[name='max_score'],[name='limit']"
          >
            <span>üí¨ Replies</span>
            {% if sort_by == 'replies' %}
              {% if order == 'desc' %}
                <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
                </svg>
              {% else %}
                <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              {% endif %}
            {% endif %}
          </button>
        </th>
        <th class="text-left font-medium">üì¢ Mentions</th>
      </tr>
    </thead>
    <tbody>
      {% for tweet in tweets %}
      <tr class="hover:bg-base-200">
        <td>
          <div class="badge badge-lg
            {% if tweet.engagement_score >= 100 %}badge-success
            {% elif tweet.engagement_score >= 50 %}badge-warning
            {% elif tweet.engagement_score >= 20 %}badge-info
            {% else %}badge-neutral{% endif %}">
            {{ tweet.engagement_score }}
          </div>
        </td>
        <td class="text-sm text-base-content/70">
          {% if tweet.posted_date %}
            {{ tweet.posted_date.strftime('%Y-%m-%d') }}
          {% else %}
            {{ tweet.fetched_at.strftime('%Y-%m-%d') }}
          {% endif %}
        </td>
        <td class="font-mono text-sm text-base-content/70">
          {{ tweet.tweet_id[:20] }}...
        </td>
        <td class="max-w-xs">
          <div class="tooltip tooltip-top" data-tip="{{ tweet.tweet_text or 'No text available' }}">
            <p class="text-sm text-base-content truncate">
              {{ tweet.tweet_text or "No text available" }}
            </p>
          </div>
        </td>
        <td>
          <div class="badge badge-error badge-outline">
            {{ tweet.like_count }}
          </div>
        </td>
        <td>
          <div class="badge badge-info badge-outline">
            {{ tweet.retweet_count }}
          </div>
        </td>
        <td>
          <div class="badge badge-success badge-outline">
            {{ tweet.reply_count }}
          </div>
        </td>
        <td>
          <div class="badge badge-warning badge-outline">
            {{ tweet.mention_count }}
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  
  <!-- Results Summary -->
  <div class="mt-6 text-center">
    <div class="stats shadow">
      <div class="stat">
        <div class="stat-title">Results</div>
        <div class="stat-value text-primary">{{ tweets|length }}</div>
        <div class="stat-desc">Total tweets displayed</div>
      </div>
      {% if min_score or max_score %}
      <div class="stat">
        <div class="stat-title">Score Range</div>
        <div class="stat-value text-secondary">
          {% if min_score and max_score %}
            {{ min_score }} - {{ max_score }}
          {% elif min_score %}
            ‚â• {{ min_score }}
          {% elif max_score %}
            ‚â§ {{ max_score }}
          {% endif %}
        </div>
        <div class="stat-desc">Filtered results</div>
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% else %}
<div class="text-center py-12">
  <div class="w-24 h-24 bg-base-300 rounded-full flex items-center justify-center mx-auto mb-6">
    <svg class="w-12 h-12 text-base-content/50" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2m0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
    </svg>
  </div>
  <h3 class="text-xl font-semibold text-base-content mb-2">No tweets found</h3>
  <p class="text-base-content/70 mb-6 max-w-md mx-auto">
    {% if min_score or max_score %}
      No tweets match your current filters. Try adjusting the score range to see more results.
    {% else %}
      Upload your CSV files to start tracking engagement metrics and see your data here.
    {% endif %}
  </p>
  <div class="flex flex-col sm:flex-row gap-3 justify-center">
    <a href="/upload" class="btn btn-primary">
      <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
      </svg>
      Upload CSV
    </a>
    {% if min_score or max_score %}
    <button class="btn btn-outline" onclick="document.getElementById('min-score').value=''; document.getElementById('max-score').value=''; document.getElementById('min-score').dispatchEvent(new Event('keyup'));">
      Clear Filters
    </button>
    {% endif %}
  </div>
</div>
{% endif %}
